<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Batchmate Profile</title>
<style>
  body {
    margin:0;
    font-family:'Arial',sans-serif;
    background-color:#000;
    color:#FFD700;
    padding:15px;
    line-height:1.6;
  }

  .profile-container {
    max-width:600px;
    margin:0 auto;
    text-align:left;
    padding:15px;
  }

  .profile-image {
    width:150px;
    max-width:100%;
    height:auto;
    object-fit:cover;
    border-radius:12px;
    border:2px solid #FFD700;
    margin-bottom:10px;
    cursor: zoom-in;
  }

  h2 {
    margin:10px 0;
    font-size:1.5em;
  }

  #profileBio p {
    margin:10px 0;
  }

  a.back {
    display:inline-block;
    margin-top:20px;
    color:#FFD700;
    text-decoration:none;
    border:1px solid #FFD700;
    padding:5px 12px;
    border-radius:5px;
    transition:all 0.3s ease;
  }

  a.back:hover {
    background-color:#FFD700;
    color:#000;
    transform: scale(1.05);
  }

  /* --- Fullscreen viewer --- */
  #imgViewer {
    display: flex;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.9);
    justify-content: center;
    align-items: center;
    z-index: 999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
    touch-action: none; /* needed for pinch-zoom handling */
  }

  #imgViewer.show {
    opacity: 1;
    pointer-events: auto;
  }

  #imgViewer img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 12px;
    transition: transform 0.3s ease;
    touch-action: pinch-zoom;
  }

  #closeViewer {
    position: absolute;
    top: 20px;
    right: 30px;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
  }

  @media (max-width:600px){
    .profile-container { padding:10px; }
  }
</style>
</head>

<body>
<div class="profile-container">
  <img id="profileImage" class="profile-image" src="" alt="Profile Image">
  <h2 id="profileName"></h2>
  <div id="profileBio"></div>
  <a href="index.html" class="back">&larr; Back to Homepage</a>
</div>

<!-- Fullscreen image viewer -->
<div id="imgViewer" class="hidden">
  <span id="closeViewer">&times;</span>
  <img id="viewerImg" src="">
</div>

<script>
async function loadProfile() {
  const params = new URLSearchParams(window.location.search);
  const bioFile = params.get('bio');

  if(!bioFile) return;

  const data = await (await fetch('directory.json')).json();
  const person = data.find(p => p.bioFile === bioFile);

  if(person){
    const profileImg = document.getElementById('profileImage');
    profileImg.src = person.image;
    profileImg.alt = person.name;
    document.getElementById('profileName').textContent = person.name;

    try {
      const bioText = await (await fetch(person.bioFile)).text();
      document.getElementById('profileBio').innerHTML = bioText
        .split(/\n\s*\n/) 
        .map(para => `<p>${para.trim()}</p>`)
        .join('');
    } catch(e){
      document.getElementById('profileBio').textContent = "Bio not available.";
      console.error("Error loading bio:", e);
    }

    // --- Click-to-fullscreen ---
    profileImg.addEventListener('click', () => {
      const viewer = document.getElementById('imgViewer');
      const viewerImg = document.getElementById('viewerImg');
      viewerImg.src = profileImg.src;
      viewerImg.style.transform = 'scale(1)'; // reset zoom
      viewer.classList.remove('hidden');
      setTimeout(() => viewer.classList.add('show'), 10);
    });
  }
}

loadProfile();

// --- Fullscreen viewer controls ---
const viewer = document.getElementById('imgViewer');
const viewerImg = document.getElementById('viewerImg');

document.getElementById('closeViewer').addEventListener('click', () => {
  viewer.classList.remove('show');
  setTimeout(() => viewer.classList.add('hidden'), 300);
});

viewer.addEventListener('click', e => {
  if(e.target.id === 'imgViewer'){
    viewer.classList.remove('show');
    setTimeout(() => viewer.classList.add('hidden'), 300);
  }
});

// --- Pinch & drag for mobile ---
let initialDistance = null;
let currentScale = 1;

viewerImg.addEventListener('touchstart', e => {
  if(e.touches.length === 2){
    e.preventDefault();
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    initialDistance = Math.sqrt(dx*dx + dy*dy);
  }
});

viewerImg.addEventListener('touchmove', e => {
  if(e.touches.length === 2 && initialDistance){
    e.preventDefault();
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    const newDistance = Math.sqrt(dx*dx + dy*dy);
    currentScale = Math.min(Math.max(newDistance / initialDistance, 1), 3); // 1xâ€“3x zoom
    viewerImg.style.transform = `scale(${currentScale})`;
  }
});

viewerImg.addEventListener('touchend', e => {
  if(e.touches.length < 2){
    initialDistance = null;
    if(currentScale < 1) currentScale = 1;
    if(currentScale > 3) currentScale = 3;
    viewerImg.style.transform = `scale(${currentScale})`;
  }
});
</script>
</body>
</html>
