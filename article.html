<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Article - Batch 85</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f7fa;
      color: #333;
    }

    header {
      background: #004c80;
      color: #fff;
      padding: 1rem;
      text-align: center;
      position: relative;
    }

    header a.back-btn {
      position: absolute;
      left: 15px;
      top: 15%;
      transform: translateY(-50%);
      background: #fff;
      color: #004c80;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: bold;
      transition: background 0.2s;
    }

    header a.back-btn:hover {
      background: #e0e0e0;
    }

    main {
      max-width: 900px;
      margin: 2rem auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1.5rem;
    }

    .featured-image {
      position: relative;
      overflow: hidden;
      border-radius: 50%;
      margin-bottom: 1rem;
      width: 80px;
      height: 80px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }

    .featured-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      transition: transform 0.3s ease;
    }

    .featured-image:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .article-title-overlay {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 1.3rem;
      display: none;
    }

    .article-meta {
      font-size: 0.9rem;
      color: #777;
      margin: 0.5rem 0 1rem;
    }

    .article-body {
      line-height: 1.7;
      font-size: 1rem;
    }

    .article-body h1, .article-body h2, .article-body h3 {
      color: #004c80;
    }

    .comments-section {
      margin-top: 2rem;
      border-top: 1px solid #ddd;
      padding-top: 1rem;
    }

    .comments-section h3 {
      color: #004c80;
    }

    .comments-section textarea {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      resize: none;
      margin-bottom: 0.5rem;
    }

    .comments-section button {
      background: #004c80;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.6rem 1rem;
      cursor: pointer;
    }

    .comments-section button:hover {
      background: #0066aa;
    }

    .comment {
      background: #f0f5fa;
      padding: 0.7rem;
      border-radius: 6px;
      margin-top: 0.5rem;
    }

    /* Fullscreen overlay for author image */
    .image-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      cursor: grab;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .image-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .image-overlay img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 12px;
      transform: translate(0px, 0px) scale(1);
      transition: transform 0.3s ease;
      cursor: grab;
    }

    /* Responsive author image */
    @media (max-width: 600px) {
      .featured-image { width: 60px; height: 60px; }
    }
    @media (max-width: 400px) {
      .featured-image { width: 50px; height: 50px; }
    }
  </style>
</head>
<body>
  <header>
    <a href="articles.html" class="back-btn">‚Üê Back to Articles</a>
    <h1>Batch'85 Blog</h1>
  </header>

  <main>
    <div class="featured-image">
      <img id="articleImage" src="Images/Authors/daniel_abalos.jpg" alt="Article Image" />
      <div class="article-title-overlay" id="articleTitleOverlay">Loading title...</div>
    </div>
    <div class="article-meta" id="articleAuthor">by elijah</div>
    <article class="article-body" id="articleBody">Loading article...</article>

    <div class="comments-section">
      <h3>Comments</h3>
      <div id="comments"></div>
      <textarea id="commentInput" placeholder="Write a comment..."></textarea>
      <button id="postComment">Post</button>
    </div>
  </main>

  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const fileName = urlParams.get('file');

    const articleTitle = document.getElementById('articleTitleOverlay');
    const articleBody = document.getElementById('articleBody');
    const commentsContainer = document.getElementById('comments');
    const postButton = document.getElementById('postComment');
    const commentInput = document.getElementById('commentInput');

    if (fileName) {
      const fileUrl = 'https://raw.githubusercontent.com/d69barrion-web/Batch-85-/main/Articles/' + fileName;

      fetch(fileUrl)
        .then(res => {
          if (!res.ok) throw new Error('Article not found');
          return res.text();
        })
        .then(markdown => {
          // Extract front matter
          const frontMatterMatch = markdown.match(/---\n([\s\S]*?)\n---/);
          let metadata = {};
          let content = markdown;

          if (frontMatterMatch) {
            const fm = frontMatterMatch[1];
            fm.split('\n').forEach(line => {
              const [key, ...rest] = line.split(':');
              metadata[key.trim()] = rest.join(':').trim();
            });
            content = markdown.replace(frontMatterMatch[0], '');
          }

          // Title
          articleTitle.textContent = metadata.title || fileName.replace('.md','');
          articleBody.innerHTML = marked.parse(content);

          // Author
          const authorName = metadata.author || 'Unknown';
          document.getElementById('articleAuthor').textContent = 'by ' + authorName;

          // Author image
          const authorImageFile = authorName.toLowerCase().replace(/\s+/g,'_') + '.jpg';
          const articleImageEl = document.getElementById('articleImage');
          articleImageEl.src = 'Images/Authors/' + authorImageFile;
          articleImageEl.onerror = () => { articleImageEl.src = 'Images/Authors/default.jpg'; };
        })
        .catch(() => {
          articleTitle.textContent = 'Error loading article';
          articleBody.textContent = 'Sorry, the requested article could not be loaded.';
        });
    } else {
      articleTitle.textContent = 'No article selected';
      articleBody.textContent = 'Please select an article from the Articles page.';
    }

    // üí¨ Comments
    const loadComments = () => {
      const saved = localStorage.getItem('comments_' + fileName);
      commentsContainer.innerHTML = '';
      if (saved) {
        const comments = JSON.parse(saved);
        comments.forEach(c => {
          const div = document.createElement('div');
          div.className = 'comment';
          div.textContent = c;
          commentsContainer.appendChild(div);
        });
      }
    };

    postButton.addEventListener('click', () => {
      const text = commentInput.value.trim();
      if (!text) return;
      const saved = JSON.parse(localStorage.getItem('comments_' + fileName) || '[]');
      saved.push(text);
      localStorage.setItem('comments_' + fileName, JSON.stringify(saved));
      commentInput.value = '';
      loadComments();
    });

    loadComments();

    // üåü Fullscreen overlay + drag + zoom + double-tap
    const articleImage = document.getElementById('articleImage');
    const overlay = document.createElement('div');
    overlay.className = 'image-overlay';
    const overlayImg = document.createElement('img');
    overlay.appendChild(overlayImg);
    document.body.appendChild(overlay);

    let scale = 1, originX = 0, originY = 0, startX = 0, startY = 0, dragging = false;
    let lastTap = 0;

    articleImage.addEventListener('click', () => {
      overlayImg.src = articleImage.src;
      overlay.classList.add('show');
      scale = 1;
      originX = 0;
      originY = 0;
      overlayImg.style.transform = `translate(0px, 0px) scale(1)`;
    });

    overlay.addEventListener('click', (e) => { if (e.target !== overlayImg) overlay.classList.remove('show'); });

    overlay.addEventListener('wheel', (e) => {
      e.preventDefault();
      scale += e.deltaY * -0.001;
      scale = Math.min(Math.max(1, scale), 3);
      overlayImg.style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
    });

    overlayImg.addEventListener('mousedown', (e) => {
      dragging = true;
      startX = e.clientX - originX;
      startY = e.clientY - originY;
      overlayImg.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', (e) => {
      if (dragging) {
        originX = e.clientX - startX;
        originY = e.clientY - startY;
        overlayImg.style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
      }
    });

    document.addEventListener('mouseup', () => {
      dragging = false;
      overlayImg.style.cursor = 'grab';
    });

    // Mobile pinch zoom
    let initialDistance = 0;
    overlayImg.addEventListener('touchstart', (e) => {
      if (e.touches.length === 2) {
        initialDistance = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
      }
    });

    overlayImg.addEventListener('touchmove', (e) => {
      if (e.touches.length === 2) {
        e.preventDefault();
        const currentDistance = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        let newScale = (currentDistance / initialDistance) * scale;
        newScale = Math.min(Math.max(1, newScale), 3);
        overlayImg.style.transform = `translate(${originX}px, ${originY}px) scale(${newScale})`;
      }
    }, { passive: false });

    // Double-tap zoom toggle
    overlayImg.addEventListener('touchend', (e) => {
      const currentTime = new Date().getTime();
      const tapLength = currentTime - lastTap;

      if (tapLength < 300 && tapLength > 0) {
        e.preventDefault();
        if (scale === 1) scale = 2;
        else { scale = 1; originX = 0; originY = 0; }
        overlayImg.style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
      }

      lastTap = currentTime;
    });
  </script>
</body>
</html>
