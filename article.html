<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Article - Batch 85</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f7fa;
      color: #333;
    }

    header {
      background: #004c80;
      color: #fff;
      padding: 1rem;
      text-align: center;
      position: relative;
    }

    header a.back-btn {
      position: absolute;
      left: 15px;
      top: 15%;
      transform: translateY(-50%);
      background: #fff;
      color: #004c80;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: bold;
      transition: background 0.2s;
    }

    header a.back-btn:hover {
      background: #e0e0e0;
    }

    main {
      max-width: 800px;
      margin: 2rem auto;
      background: #fff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .article-meta {
      color: #777;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
    }

    .nav-btn {
      background: #004c80;
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
    }

    .nav-btn:hover {
      background: #0060a0;
    }

    .nav-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <header>
    <a href="articles.html" class="back-btn">← Back to Articles</a>
    <h1 id="articleTitle">Loading...</h1>
  </header>

  <main>
    <div class="article-meta" id="articleAuthor">by Elijah</div>
    <article id="articleContent">Loading article...</article>

    <div class="navigation">
      <button id="prevBtn" class="nav-btn">← Previous</button>
      <button id="nextBtn" class="nav-btn">Next →</button>
    </div>
  </main>

  <script>
  const repoOwner = "d69barrion-web";
  const repoName = "Batch-85-";
  const basePath = "Articles";

  const urlParams = new URLSearchParams(window.location.search);
  const folderName = urlParams.get("folder"); // e.g. "pagod-pera-pananaw"
  let fileIndex = parseInt(urlParams.get("index")) || 0;

  const titleEl = document.getElementById("articleTitle");
  const contentEl = document.getElementById("articleContent");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");

  async function fetchJSON(url) {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    return await response.json();
  }

  async function loadArticle() {
    if (!folderName) {
      titleEl.textContent = "Error";
      contentEl.innerHTML = "No folder specified.";
      prevBtn.style.display = "none";
      nextBtn.style.display = "none";
      return;
    }

    try {
      const folderUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${basePath}/${folderName}`;
      const files = await fetchJSON(folderUrl);

      const mdFiles = files.filter(f => f.name.endsWith(".md"));
      mdFiles.sort((a, b) => a.name.localeCompare(b.name)); // sort alphabetically

      if (mdFiles.length === 0) {
        contentEl.innerHTML = "No markdown files in this folder.";
        prevBtn.style.display = "none";
        nextBtn.style.display = "none";
        return;
      }

      // Clamp fileIndex
      if (fileIndex < 0) fileIndex = 0;
      if (fileIndex >= mdFiles.length) fileIndex = mdFiles.length - 1;

      const currentFile = mdFiles[fileIndex];
      const fileResponse = await fetch(currentFile.download_url);
      const text = await fileResponse.text();

      // Convert Markdown to HTML (simple)
      const html = text
        .replace(/^# (.*$)/gim, "<h1>$1</h1>")
        .replace(/^## (.*$)/gim, "<h2>$1</h2>")
        .replace(/^### (.*$)/gim, "<h3>$1</h3>")
        .replace(/\*\*(.*)\*\*/gim, "<b>$1</b>")
        .replace(/\*(.*)\*/gim, "<i>$1</i>")
        .replace(/\n$/gim, "<br />");

      titleEl.textContent = currentFile.name.replace(".md", "").replace(/[-_]/g, " ");
      contentEl.innerHTML = html;

      // Load sibling folders to know next/prev article
      const articlesUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${basePath}`;
      const folders = await fetchJSON(articlesUrl);
      const subfolders = folders.filter(f => f.type === "dir").map(f => f.name);
      const currentFolderIndex = subfolders.indexOf(folderName);

      // Determine button visibility
      const multiplePages = mdFiles.length > 1;
      const multipleFolders = subfolders.length > 1;

      if (multiplePages) {
        prevBtn.disabled = fileIndex === 0;
        nextBtn.disabled = fileIndex === mdFiles.length - 1;

        prevBtn.onclick = () => {
          if (fileIndex > 0) {
            window.location.href = `article.html?folder=${folderName}&index=${fileIndex - 1}`;
          }
        };

        nextBtn.onclick = () => {
          if (fileIndex < mdFiles.length - 1) {
            window.location.href = `article.html?folder=${folderName}&index=${fileIndex + 1}`;
          }
        };
      } else if (multipleFolders) {
        const prevFolder = subfolders[currentFolderIndex - 1];
        const nextFolder = subfolders[currentFolderIndex + 1];

        if (!prevFolder) prevBtn.style.display = "none";
        if (!nextFolder) nextBtn.style.display = "none";

        prevBtn.textContent = "← Previous Article";
        nextBtn.textContent = "Next Article →";

        prevBtn.onclick = () => {
          if (prevFolder) window.location.href = `article.html?folder=${prevFolder}`;
        };

        nextBtn.onclick = () => {
          if (nextFolder) window.location.href = `article.html?folder=${nextFolder}`;
        };
      } else {
        // Only one folder and one file — hide navigation
        prevBtn.style.display = "none";
        nextBtn.style.display = "none";
      }

    } catch (err) {
      titleEl.textContent = "Error loading article";
      contentEl.innerHTML = `<p style="color:red;">${err.message}</p>`;
      prevBtn.style.display = "none";
      nextBtn.style.display = "none";
    }
  }

  loadArticle();
  </script>
</body>
</html>
